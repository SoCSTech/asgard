---
interface Props {
  title: string;
}

const { title } = Astro.props;
import BaseLayout from "@/layouts/BaseLayout.astro";
import Header from "@/components/theme/header";
import Footer from "@/components/theme/footer.astro";
---

<script>
  import { getCookie } from "@/lib/cookie";
  import { verifyToken } from "@/lib/auth";

  const expectedUrl = encodeURI(
    window.location.pathname + window.location.search
  );

  const token = getCookie("token");
  let user = null;

  if (token) {
    try {
      const result = await verifyToken(token);
      console.log(user);

      if (result.valid && result.user) {
        user = result.user;
        console.log(user);
      }
    } catch (error) {
      console.error("Token verification failed:", error);
      window.location.href = "/login?redirect=" + expectedUrl;
    }
  } else {
    console.log("No token found");
    window.location.href = "/login?redirect=" + expectedUrl;
  }
</script>

<BaseLayout title={title} class="flex flex-col min-h-screen justify-between">
  <Header client:only="react" />
  <div
    class="mb-auto tablet:mx-20 w-auto max-w-[1140px] border-red-400 border-2"
  >
    <slot />
  </div>
  <Footer />
</BaseLayout>
